---
import { Contract, ContractResolutionStatusIds } from "../../../types/contracts";
import { getBlockExplorerUrlForContract } from "../../../utils/chains";
import { cn } from "../../../utils/tailwindClassConcatenation";
import { shadcnButtonVariants } from "../../ui/shadcnButtonStyles";
import { ExternalLinkWithIcon } from "../Link";
import { SmartContractMetadata } from "../SmartContractMetadata";
import { ContractBadge } from "../badges/ContractBadge";
export interface ContractCardProps {
  contract: Contract;
}

const { contract }: ContractCardProps = Astro.props;
---

<div
  class="w-full h-fit min-h-[80px] box-border flex flex-col-reverse sm:flex-row flex-wrap justify-start min-[970px]:justify-between items-start sm:items-center gap-3 sm:gap-y-5
            p-4 sm:p-5 rounded-2xl border border-gray-200">
  <div
    class="max-sm:w-full sm:min-w-[425px] flex flex-col justify-start items-start">
    <p class="text-sm leading-normal font-normal text-muted-foreground">
      {contract.cachedIdentity.contract.codeName}
    </p>
    <ExternalLinkWithIcon
      href={getBlockExplorerUrlForContract(
        contract.cachedIdentity.contract.chain.id,
        contract.cachedIdentity.contract.address,
      )}
      className="text-sm leading-snug font-medium text-black max-sm:break-all"
      >{contract.cachedIdentity.contract.address}</ExternalLinkWithIcon
    >
  </div>
  <div
    class="sm:min-w-[225px] h-[42px] flex flex-col justify-start items-start">
    <p class="text-sm leading-normal font-normal text-muted-foreground">
      ENS name
    </p>
    {
      contract.cachedIdentity.resolutionStatus ===
        ContractResolutionStatusIds.PrimaryNamed ||
      contract.cachedIdentity.resolutionStatus ===
        ContractResolutionStatusIds.ForwardNamed ? (
        <ExternalLinkWithIcon
          href={`https://app.ens.domains/${encodeURIComponent(contract.cachedIdentity.name)}`}
          className="text-sm leading-snug font-medium text-blue-600 whitespace-nowrap">
          {contract.cachedIdentity.name}
        </ExternalLinkWithIcon>
      ) : (
        <p class="text-sm leading-normal font-medium">Unnamed contract</p>
      )
    }
  </div>
  <div
    class="hidden sm:flex flex-col justify-start items-start sm:min-w-[175px] gap-1">
    {
      contract.cachedIdentity.resolutionStatus ===
        ContractResolutionStatusIds.PrimaryNamed ||
      contract.cachedIdentity.resolutionStatus ===
        ContractResolutionStatusIds.ForwardNamed ? (
        <>
          <p class="text-sm leading-normal font-normal text-muted-foreground">
            ENS metadata
          </p>
          <SmartContractMetadata
            client:load
            name={contract.cachedIdentity.name}
            metadata={contract.cachedIdentity.profile}
          />
        </>
      ) : (
        <a
          href="https://app.enscribe.xyz/nameContract"
          target="_blank"
          rel="noreferrer noopened"
          class={cn(
            shadcnButtonVariants({
              variant: "default",
              size: "default",
              className: "cursor-pointer rounded-full",
            }),
          )}>
          Set contract name
        </a>
      )
    }
  </div>
  <div
    class="max-sm:flex max-sm:flex-row max-sm:justify-between max-sm:items-center sm:min-w-[115px] max-sm:self-stretch">
    <ContractBadge
      client:load
      contractResolutionStatus={contract.cachedIdentity.resolutionStatus}
    />
    <div class="flex sm:hidden flex-col justify-start items-start gap-1">
      {
        contract.cachedIdentity.resolutionStatus ===
          ContractResolutionStatusIds.PrimaryNamed ||
        contract.cachedIdentity.resolutionStatus ===
          ContractResolutionStatusIds.ForwardNamed ? (
          <>
            <p class="text-sm leading-normal font-normal text-muted-foreground">
              ENS metadata
            </p>
            <SmartContractMetadata
              client:load
              name={contract.cachedIdentity.name}
              metadata={contract.cachedIdentity.profile}
            />
          </>
        ) : (
          <a
            href="https://app.enscribe.xyz/nameContract"
            target="_blank"
            rel="noreferrer noopened"
            class={cn(
              shadcnButtonVariants({
                variant: "default",
                size: "default",
                className: "cursor-pointer rounded-full",
              }),
            )}>
            Set contract name
          </a>
        )
      }
    </div>
  </div>
</div>
