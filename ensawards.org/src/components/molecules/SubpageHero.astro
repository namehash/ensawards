---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import SubpageHeroImage from "../../assets/subpageHeroImage.png";
import { cn } from "../../utils/tailwindClassConcatenation";
import Breadcrumbs from "../atoms/Breadcrumbs.astro";

interface additionalHeroElement {
  name: string;
  value: string;
  link?: string;
  externalLink?: string;
}
export interface SubpageHeroProps {
  header: string;
  description?: string;
  breadcrumbs?: string[]; //May change depending on astro's policy on breadcrumbs
  // (update: there is external & validated (shown as an official astro lib) library, but requires SASS styling and is yet another dependency, so for now I'll try doing it manually)
  customImage?: {
    source: string;
    width: number;
    height: number;
    alt?: string;
    styles?: string;
  };
  additionalElements?: additionalHeroElement[];
}

const images = import.meta.glob<{ default: ImageMetadata }>("/src/assets/*.{jpeg,jpg,png,gif,svg}");

const {
  header,
  description,
  breadcrumbs,
  icon,
  customImage,
  additionalElements,
}: SubpageHeroProps = Astro.props;
---

<section
  class="w-full h-fit min-h-[184px] sm:min-h-[288px] box-border px-5 sm:px-8 pt-5 sm:pt-8 pb-6 sm:pb-10 flex flex-nowrap flex-col items-center justify-end bg-gradient-to-b from-[#161547] to-[#080E32] overflow-hidden">
  <div
    class={cn(
      "relative w-full max-w-[1216px] h-fit sm:min-h-[200px] flex flex-nowrap flex-col justify-end gap-10 sm:gap-[60px]",
      breadcrumbs && "justify-between",
    )}>
    <Image
      src={customImage ? images[customImage.source]() : SubpageHeroImage}
      alt={customImage?.alt ? customImage.alt : header}
      quality={100}
      width={customImage ? customImage.width : 948}
      height={customImage ? customImage.height : 848}
      class={cn(
        "hidden sm:block absolute -right-60 -top-55 opacity-60",
        customImage?.styles,
      )}
    />
    {
      breadcrumbs && (
        <Breadcrumbs
          breadcrumbs={breadcrumbs}
          styles={{ home: "text-white" }}
        />
      )
    }
    <div
      class="h-fit flex flex-nowrap flex-col md:flex-row items-center md:items-end justify-center md:justify-between gap-4">
      <div
        class="max-md:w-full flex flex-nowrap flex-col items-start justify-end gap-2 sm:gap-4 relative z-10">
        <slot name="icon" />
        <div class="flex flex-nowrap flex-col items-start justify-start gap-2">
          <h1
            class="text-white text-3xl sm:text-[44px] leading-normal sm:leading-[52px] font-semibold">
            {header}
          </h1>
          {
            description && (
              <p class="w-fit max-w-[580px] text-sm sm:text-base leading-6 sm:leading-7 font-normal text-gray-400">
                {description} <slot name="technicalSectionAnchor" />
              </p>
            )
          }
        </div>
        <slot name="ctaContent" />
      </div>
      {
        additionalElements && (
          <div class="block sm:hidden bg-white/15 h-[1px] self-stretch" />
        )
      }
      {
        additionalElements && (
          <div class="w-full md:w-fit h-full flex-col justify-center md:justify-end items-center relative z-10">
            <div class="flex flex-col md:flex-row flex-nowrap justify-center md:justify-start items-start gap-2 sm:gap-8 md:gap-14">
              <slot name="extraAdditionalElement" />
              {additionalElements.map((elem) => (
                <div class="flex flex-row md:flex-col flex-nowrap justify-between md:justify-center items-center md:items-start md:gap-0 leading-7 max-md:self-stretch">
                  <p class="text-gray-400 whitespace-nowrap">{elem.name}</p>
                  {elem.link ? (
                    <a
                      class="text-base leading-normal font-medium text-white underline underline-offset-[25%] decoration-white/40 hover:decoration-white transition-all duration-200 whitespace-nowrap"
                      href={elem.link}>
                      {elem.value}
                    </a>
                  ) : elem.externalLink ? (
                    <a
                      href={elem.externalLink}
                      target="_blank"
                      rel="noreferrer noopened"
                      class="text-base leading-normal font-medium text-white underline underline-offset-[25%] decoration-white/40 hover:decoration-white transition-all duration-200 whitespace-nowrap">
                      {elem.value}
                    </a>
                  ) : (
                    <p class="text-base leading-normal font-medium text-white">
                      {elem.value}
                    </p>
                  )}
                </div>
              ))}
            </div>
          </div>
        )
      }
      <slot name="largerHeroItem" />
    </div>
  </div>
</section>
