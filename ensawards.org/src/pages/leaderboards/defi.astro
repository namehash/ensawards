---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

import LeaderboardCard from "../../components/atoms/cards/LeaderboardCard.astro";
import ItemsList from "../../components/molecules/ItemsList.astro";
import SubpageHero from "../../components/molecules/SubpageHero.astro";
import { contractPipeline } from "../../contract-pipelines";
import { defiContractsOnly } from "../../contract-pipelines/filters";
import { sortProtocolLeaderboard } from "../../contract-pipelines/sorting";
import Layout from "../../layouts/Layout.astro";
import { DefiProtocolId } from "../../types/protocols";
import { getDefiProtocolByProtocolId } from "../../utils/dataAccess";

const defiScores = contractPipeline({
  filter: defiContractsOnly,
  sort: sortProtocolLeaderboard,
});

const images = import.meta.glob<{ default: ImageMetadata }>("/src/assets/*.{jpeg,jpg,png,gif,svg}");
const placeIcons = [
  "/src/assets/firstPlaceAward.svg",
  "/src/assets/secondPlaceAward.svg",
  "/src/assets/thirdPlaceAward.svg",
];
---

<Layout
  pageMetadata={{
    title: "ENSAwards: ENS Leaderboard for Defi protocol Integrations",
    description: "See how Defi protocols score on ENS integration benchmarks.",
    url: "https://ensawards.org/leaderboards/defi",
    ogImage: "https://ensawards.org/defi_leaderboard_og_image.png",
    twitterImage: "https://ensawards.org/defi_leaderboard_twitter_og_image.png",
  }}>
  <SubpageHero
    header="Defi leaderboard"
    description="Compare Defi protocols by their rank of following a selection of ENS best practices."
    breadcrumbs={["ENS leaderboards"]}
    customImage={{
      source: "/src/assets/leaderboardsHeroImage.png",
      width: 371,
      height: 372,
      styles: "-top-0 right-0",
    }}
  />
  <section
    class="w-full box-border h-fit flex flex-col flex-nowrap justify-start items-center max-sm:gap-6 gap-10 p-5 sm:py-[60px] sm:px-8">
    <ItemsList containerStyles="gap-3 sm:gap-3">
      {
        Object.entries(defiScores).map(([scoreCategory, value], idx) => {
          const defiId = scoreCategory as DefiProtocolId;
          const defiProtocol = getDefiProtocolByProtocolId(defiId);
          const DefiIcon = defiProtocol.icon;
          return (
            <LeaderboardCard
              key={`defi-leaderboard-card-${defiProtocol.id}`}
              name={defiProtocol.name}
              ensAwardsScore={value}
              viewDetailsLink={`/defi/${defiProtocol.slug}`}
              viewDetailsText="Defi protocol report">
              {idx < 3 ? (
                <Image
                  alt={`${idx + 1}-place`}
                  src={images[placeIcons[idx]]()}
                  slot="placeIcon"
                />
              ) : (
                <p
                  slot="placeIcon"
                  class="w-8 pt-[7px] px-[11px] pb-[5px] text-sm leading-normal font-semibold text-muted-foreground">
                  {idx + 1}
                </p>
              )}
              <DefiIcon slot="appIcon" className="w-10 h-10 rounded-md" />
            </LeaderboardCard>
          );
        })
      }
    </ItemsList>
  </section>
</Layout>
