---
import { Image } from "astro:assets";
import { ENS_HOLIDAY_AWARDS_END_DATE } from "@namehash/ens-referrals";
import type { ImageMetadata } from "astro";
import AlertCountdown from "../../components/atoms/AlertCountdown.astro";
import LeaderboardCard from "../../components/atoms/cards/LeaderboardCard.astro";
import SuggestionCard from "../../components/atoms/cards/SuggestionCard.astro";
import ItemsList from "../../components/molecules/ItemsList.astro";
import SubpageHero from "../../components/molecules/SubpageHero.astro";
import { APPS } from "../../data/apps";
import Layout from "../../layouts/Layout.astro";
import { calculateAppEnsAwardsScore } from "../../utils/dataAccess";

const images = import.meta.glob<{ default: ImageMetadata }>("/src/assets/*.{jpeg,jpg,png,gif,svg}");
const placeIcons = [
  "/src/assets/firstPlaceAward.svg",
  "/src/assets/secondPlaceAward.svg",
  "/src/assets/thirdPlaceAward.svg",
];
---

<Layout
  pageMetadata={{
    title: "ENSAwards: ENS Leaderboard for App Integrations",
    description: "See how apps score on ENS integration benchmarks.",
    url: "https://ensawards.org/leaderboards/app",
    ogImage: "https://ensawards.org/app_leaderboard_og_image.png",
    twitterImage: "https://ensawards.org/app_leaderboard_twitter_og_image.png",
  }}>
  <AlertCountdown
    slot="alertBanner"
    eventUnixTimestamp={ENS_HOLIDAY_AWARDS_END_DATE}
    eventText="ENS Holiday Awards ends in"
    ctaText="Learn more"
    link="/ens-referral-awards"
    styles={{
      banner: "bg-blue-700 hover:bg-blue-700/90 transition-all duration-200",
      cta: "text-white decoration-white/40 hover:decoration-white",
      text: "text-white",
      timer: "text-white",
      timerLegend: "text-white",
    }}
  />
  <SubpageHero
    header="App leaderboard"
    description="Compare apps by their rank of following a selection of ENS best practices."
    breadcrumbs={["ENS leaderboards"]}
    customImage={{
      source: "/src/assets/leaderboardsHeroImage.png",
      width: 371,
      height: 372,
      styles: "-top-0 right-0",
    }}
  />
  <section
    class="w-full box-border h-fit flex flex-col flex-nowrap justify-start items-center max-sm:gap-6 gap-10 p-5 sm:py-[60px] sm:px-8">
    <ItemsList containerStyles="gap-3 sm:gap-3">
      {
        APPS.sort(
          (a, b) =>
            calculateAppEnsAwardsScore(b) - calculateAppEnsAwardsScore(a),
        ).map((app, idx) => (
          <LeaderboardCard
            key={`app-review-card-${app.id}`}
            name={app.name}
            ensAwardsScore={calculateAppEnsAwardsScore(app)}
            type={app.type}
            viewDetailsLink={`/app/${app.slug}`}
            viewDetailsText="App report">
            <Image
              src={images[app.iconPath]()}
              alt={`${app.id}`}
              slot="appIcon"
              class="w-10 h-10 rounded-md"
            />
            {idx < 3 ? (
              <Image
                alt={`${idx + 1}-place`}
                src={images[placeIcons[idx]]()}
                slot="placeIcon"
              />
            ) : (
              <p
                slot="placeIcon"
                class="w-8 pt-[7px] px-[11px] pb-[5px] text-sm leading-normal font-semibold text-muted-foreground">
                {idx + 1}
              </p>
            )}
          </LeaderboardCard>
        ))
      }
      <SuggestionCard whatsSuggested="app" />
    </ItemsList>
  </section>
</Layout>
