---
import AppBestPracticeDetails from "../../../components/organisms/AppBestPracticeDetails.astro";
import DataLoadingError from "../../../components/organisms/DataLoadingError.astro";
import ProtocolBestPracticeDetails from "../../../components/organisms/ProtocolBestPracticeDetails.astro";
import { BEST_PRACTICE_CATEGORIES } from "../../../data/bestPractices";
import Layout from "../../../layouts/Layout.astro";
import { BestPracticeTypes } from "../../../types/bestPractices";
import { getBestPracticeBySlug } from "../../../utils/dataAccess";
export function getStaticPaths() {
  const staticPaths = [];

  for (let category of BEST_PRACTICE_CATEGORIES) {
    category.bestPractices.forEach((bestPractice) =>
      staticPaths.push({
        params: { category: category.slug, bestPractice: bestPractice.slug },
      }),
    );
  }
  return staticPaths;
}

const { category, bestPractice } = Astro.params;

const bestPracticeToDisplay = getBestPracticeBySlug(bestPractice);
---

{
  bestPracticeToDisplay === undefined ? (
    // theoretically, because of Astro's build-time page generation, this should never happen
    <DataLoadingError />
  ) :
  <Layout
      pageMetadata={{
          title: `ENSAwards: ${bestPracticeToDisplay.name}`,
          description: bestPracticeToDisplay.description,
          url: `https://ensawards.org/ens-best-practices/${bestPracticeToDisplay.categorySlug}/${bestPracticeToDisplay.slug}`,
      }}>
      {bestPracticeToDisplay.type === BestPracticeTypes.App ? (
        <AppBestPracticeDetails bestPractice={bestPracticeToDisplay} />
      ) : (
        <ProtocolBestPracticeDetails bestPractice={bestPracticeToDisplay} />
      )}
      <script>
      import {scrollWithOffset} from "../../../utils/domActions";
      class AnchorToTechnicalInfo extends HTMLElement {
      connectedCallback() {
          const scrollAnchor = document.getElementById(
              `${this.dataset.id}-technical-info-anchor`,
          );

          if (!scrollAnchor) return;

          scrollAnchor.addEventListener("click", (event) => {
              event.preventDefault();
              scrollWithOffset(`${this.dataset.id}-technical-info`, 60);
          });
        }
      }

      if (!customElements.get("technical-info-anchor")) {
          customElements.define("technical-info-anchor", AnchorToTechnicalInfo);
      }
      </script>
  </Layout>
}
