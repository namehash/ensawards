---
import { ChainIcon } from "../../components/atoms/ChainIcon";
import DaoScore from "../../components/atoms/DaoScore.astro";
import ContractCard from "../../components/atoms/cards/ContractCard.astro";
import DollarEnsIcon from "../../components/atoms/icons/DollarEnsIcon.astro";
import EnscribeIcon from "../../components/atoms/icons/EnscribeIcon.astro";
import GlobeIcon from "../../components/atoms/icons/GlobeIcon.astro";
import TwitterIcon from "../../components/atoms/icons/TwitterIcon.astro";
import ItemsList from "../../components/molecules/ItemsList.astro";
import SubpageHero from "../../components/molecules/SubpageHero.astro";
import { shadcnButtonVariants } from "../../components/ui/shadcnButtonStyles";
import { CONTRACTS } from "../../data/contracts";
import { ORGANIZATIONS } from "../../data/organizations";
import Layout from "../../layouts/Layout.astro";
import { OrganizationNames } from "../../types/organizations";
import { normalizeText } from "../../utils";
import { SUPPORTED_CHAINS, getChainName } from "../../utils/chains";
import { cn } from "../../utils/tailwindClassConcatenation";
export function getStaticPaths() {
  return Object.values(OrganizationNames).map((contract) => ({
    params: { org: normalizeText(contract) },
  }));
}

const { org } = Astro.params;

const resolvedOrg = Object.values(ORGANIZATIONS).find(
  (maybeOrg) => normalizeText(maybeOrg.name) === org,
);
const orgContracts = CONTRACTS.filter((contract) => contract.org.name === resolvedOrg.name);

const OrgIcon = resolvedOrg.icon;
---

<Layout>
  <SubpageHero
    header={resolvedOrg.name}
    description={resolvedOrg.description}
    breadcrumbs={["DAO Report"]}>
    <OrgIcon slot="icon" className="w-[60px] h-[60px] shrink-0 rounded-lg" />
    <div
      slot="socialLinks"
      class="flex flex-row flex-nowrap justify-start items-center gap-2">
      <a
        href={resolvedOrg.socialLinks.websiteLink}
        rel="noreferrer noopener"
        target="_blank"
        ><GlobeIcon
          className="hover:text-white text-gray-400 transition-all duration-200"
        /></a
      >
      <a
        href={resolvedOrg.socialLinks.twitterLink}
        rel="noreferrer noopener"
        target="_blank"
        ><TwitterIcon
          className="hover:text-white text-gray-400 transition-all duration-200"
        /></a
      >
    </div>
    <DaoScore slot="score" daoName={resolvedOrg.name} />
  </SubpageHero>
  <!--because of Astro's build-time page generation we are sure that 'resolvedProject' will never be undefined-->
  <section
    class="w-full box-border h-fit flex flex-col flex-nowrap justify-start items-center gap-10 p-5 sm:py-[60px] sm:px-8">
    <a
      href="https://discuss.ens.domains/t/temp-check-ens-contract-naming-season/21402"
      target="_blank"
      rel="noreferrer noopener"
      class="max-w-[1216px] w-full h-fit sm:h-[88px] flex flex-col sm:flex-row flex-nowrap justify-start sm:justify-between items-center bg-[linear-gradient(0deg,#F9D25A_0%,#F4BF1A_100%)] sm:bg-[linear-gradient(90deg,#F9D25A_0%,#F4BF1A_100%)] p-4 sm:px-6 rounded-lg">
      <div
        class="flex flex-col sm:flex-row flex-nowrap justify-start items-center gap-3 sm:gap-5">
        <DollarEnsIcon />
        <div>
          <h4
            class="text-lg font-semibold leading-7 max-sm:self-stretch max-sm:text-center">
            ENS Contract Naming Season
          </h4>
          <p
            class="text-sm text-black/50 font-normal leading-7 max-sm:self-stretch max-sm:text-center">
            Up to 10,000 $ENS in awards
          </p>
        </div>
      </div>
      <button
        class={cn(
          shadcnButtonVariants({
            variant: "ghost",
            size: "default",
            className: "cursor-pointer rounded-full hover:bg-black/5",
          }),
        )}>Learn more</button
      >
    </a>
    <ItemsList header="Smart contract naming" containerStyles="gap-2 sm:gap-2">
      <a
        href="https://www.enscribe.xyz/"
        target="_blank"
        rel="noreferrer noopener"
        slot="ctaButton"
        class="w-fit h-fit flex flex-col sm:flex-row flex-nowrap justify-start items-start sm:items-center gap-1 sm:gap-3 px-2 sm:px-4 py-1 sm:py-2 bg-gray-50 rounded-lg border border-gray-200 hover:border-gray-300 text-sm text-gray-400 hover:text-gray-500 font-normal leading-normal sm:leading-7 hover:shadow-xs transition duration-200">
        Powered by <EnscribeIcon />
      </a>
      {
        SUPPORTED_CHAINS.map((supportedChain, idx) => {
          const contractsOnChain = orgContracts.filter(
            (contract) => contract.chain.id === supportedChain.id,
          );
          if (contractsOnChain.length === 0) {
            return null;
          }

          return (
            <>
              <div
                class={cn(
                  "h-fit w-full flex flex-row flex-nowrap justify-start items-center gap-4 pb-2 sm:pb-4",
                  idx > 0 && "pt-6 sm:pt-8",
                )}>
                <>
                  <span class="w-10 h-10 bg-white flex flex-col justify-center items-center rounded-lg border border-gray-200">
                    <ChainIcon chainId={supportedChain.id} />
                  </span>
                  <h4 class="text-xl text-black leading-normal font-semibold">
                    {getChainName(supportedChain.id)}
                  </h4>
                </>
              </div>
              {contractsOnChain.map((contract) => (
                <ContractCard contract={contract} />
              ))}
            </>
          );
        })
      }
    </ItemsList>
  </section>
</Layout>
